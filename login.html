<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Foodie Zone</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Outfit', sans-serif;
      background-color: #111827;
      color: #f3f4f6;
    }
  </style>
</head>

<body class="flex items-center justify-center min-h-screen p-4">

  <div class="bg-gray-800 rounded-2xl shadow-2xl flex overflow-hidden w-full max-w-4xl min-h-[500px]">

    <!-- Left Side: Image & Branding -->
    <div
      class="hidden md:flex w-1/2 bg-emerald-900 relative flex-col justify-center items-center text-white p-8 text-center">

      <div class="absolute inset-0 z-0 opacity-40">
        <img src="https://images.unsplash.com/photo-1543353071-873f17a7a088?q=80&w=800"
          class="w-full h-full object-cover">
      </div>

      <div class="relative z-10">
        <h1 class="text-4xl font-bold mb-2">Foodie Zone</h1>

        <p class="text-emerald-100">Experience the Joy of Authentic Food</p>
      </div>
    </div>

    <!-- Right Side: Forms -->
    <div class="w-full md:w-1/2 p-8 md:p-12 relative">

      <!-- Navbar Back Link -->
      <a href="index.html" class="absolute top-4 right-4 text-gray-400 hover:text-white text-sm">
        <i class="fa-solid fa-arrow-left"></i> Back to Home
      </a>

      <!-- Tabs -->
      <div class="flex gap-6 mb-8 border-b">
        <button onclick="switchTab('login')" id="tabLogin"
          class="pb-2 border-b-2 border-emerald-500 font-bold text-emerald-500">Login</button>
        <button onclick="switchTab('signup')" id="tabSignup"
          class="pb-2 border-b-2 border-transparent text-gray-400 hover:text-white">Sign Up</button>
      </div>

      <!-- Login Form -->
      <form id="loginForm" class="space-y-4">
        <h2 class="text-2xl font-bold mb-4">Welcome Back</h2>

        <div>
          <label class="block text-sm font-medium text-gray-300">Phone or Email</label>
          <input type="text" id="loginUser"
            class="w-full border border-gray-600 rounded-lg p-3 bg-gray-700 text-white focus:outline-emerald-500"
            placeholder="Enter your details">
        </div>

        <div class="relative">
          <label class="block text-sm font-medium text-gray-300">Password</label>
          <input type="password" id="loginPass"
            class="w-full border border-gray-600 rounded-lg p-3 bg-gray-700 text-white focus:outline-emerald-500 pr-10"
            placeholder="••••••••">
          <i class="fa-solid fa-eye absolute right-4 top-9 text-gray-400 cursor-pointer" id="toggleLoginPass"></i>

          <div class="flex justify-between items-center mt-2">
            <label class="flex items-center gap-2 text-sm text-gray-400 cursor-pointer">
              <input type="checkbox" id="userRememberMe"
                class="w-4 h-4 rounded border-gray-600 text-emerald-600 bg-gray-700">
              Remember me
            </label>
            <a href="#" class="text-xs text-emerald-500 hover:text-emerald-400">Forgot Password?</a>
          </div>
        </div>

        <button type="button" onclick="handleLogin()"
          class="w-full bg-emerald-600 text-white font-bold py-3 rounded-lg hover:bg-emerald-700 transition mt-6 disabled:opacity-50">
          Login Securely
        </button>
      </form>

      <!-- Signup Form -->
      <form id="signupForm" class="space-y-4 hidden">
        <h2 class="text-2xl font-bold mb-4">Create Account</h2>

        <div>
          <label class="block text-sm font-medium text-gray-300">Username</label>
          <input type="text" id="signupUser"
            class="w-full border border-gray-600 rounded-lg p-3 bg-gray-700 text-white focus:outline-emerald-500"
            placeholder="karthikeyan">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-300">Email Address</label>
          <input type="email" id="signupEmail"
            class="w-full border border-gray-600 rounded-lg p-3 bg-gray-700 text-white focus:outline-emerald-500"
            placeholder="name@example.com">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-300">Create Password</label>
          <input type="password" id="signupPass"
            class="w-full border border-gray-600 rounded-lg p-3 bg-gray-700 text-white focus:outline-emerald-500"
            placeholder="Minimum 6 chars">
        </div>

        <button type="button" onclick="handleSignup()"
          class="w-full bg-emerald-600 text-white font-bold py-3 rounded-lg hover:bg-emerald-700 transition mt-6">
          Sign Up
        </button>
      </form>

    </div>
  </div>

  </div>

  <script src="assets/js/toast.js"></script>
  <script>
    // Use Global Toast instead of alert
    window.alert = function (msg) { showToast(msg, msg.includes('success') || msg.includes('Success') || msg.includes('accepted') ? 'success' : 'info'); };

    // Load Remembered User
    const savedUser = localStorage.getItem('rememberedUserEmail');
    if (savedUser) {
      document.getElementById('loginUser').value = savedUser;
      document.getElementById('userRememberMe').checked = true;
    }

    // Toggle Password Visibility
    document.getElementById('toggleLoginPass').addEventListener('click', function () {
      const input = document.getElementById('loginPass');
      const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
      input.setAttribute('type', type);
      this.classList.toggle('fa-eye');
      this.classList.toggle('fa-eye-slash');
    });

    function switchTab(tab) {
      const loginForm = document.getElementById('loginForm');
      const signupForm = document.getElementById('signupForm');
      const tabLogin = document.getElementById('tabLogin');
      const tabSignup = document.getElementById('tabSignup');

      if (tab === 'login') {
        loginForm.classList.remove('hidden');
        signupForm.classList.add('hidden');
        tabLogin.classList.add('border-emerald-500', 'text-emerald-500');
        tabLogin.classList.remove('border-transparent', 'text-gray-400');
        tabSignup.classList.remove('border-emerald-500', 'text-emerald-500');
        tabSignup.classList.add('border-transparent', 'text-gray-400');
      } else {
        loginForm.classList.add('hidden');
        signupForm.classList.remove('hidden');
        tabSignup.classList.add('border-emerald-500', 'text-emerald-500');
        tabSignup.classList.remove('border-transparent', 'text-gray-400');
        tabLogin.classList.remove('border-emerald-500', 'text-emerald-500');
        tabLogin.classList.add('border-transparent', 'text-gray-400');
      }
    }

    async function handleSignup() {
      const username = document.getElementById('signupUser').value;
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPass').value;

      if (!username || !email || !password) {
        alert("Please fill all fields");
        return;
      }

      try {
        const res = await fetch('/api/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, email, password })
        });

        const data = await res.json();
        if (data.success) {
          alert("Account created successfully! Please login.");
          switchTab('login');
        } else {
          alert(data.message || "Signup failed");
        }
      } catch (e) {
        console.error("Signup error", e);
        alert("Connection error. Is the server running?");
      }
    }

    async function handleLogin() {
      const user = document.getElementById('loginUser').value;
      const pass = document.getElementById('loginPass').value;
      const rememberMe = document.getElementById('userRememberMe').checked;

      if (!user) {
        alert("Please enter username");
        return;
      }

      // Try connecting to backend
      try {
        const res = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: user, password: pass })
        });

        if (res.ok) {
          const data = await res.json();
          if (data.success) {
            localStorage.setItem('currentUser', JSON.stringify(data.user));

            if (rememberMe) {
              localStorage.setItem('rememberedUserEmail', user);
            } else {
              localStorage.removeItem('rememberedUserEmail');
            }

            window.location.href = 'index.html';
            return;
          } else {
            alert(data.message || "Invalid credentials");
          }
        } else {
          // Server is there but returned error (e.g. 401)
          const data = await res.json();
          alert(data.message || "Login failed");
        }
      } catch (e) {
        console.log("Offline login fallback", e);
        // Fallback if server is not running or network error, 
        // just so the user can test the UI without backend.
        // Store valid JSON so profile doesn't crash.
        const u = { username: user, email: user + '@example.com' };
        localStorage.setItem('currentUser', JSON.stringify(u));
        alert("Logged in (Offline Mode)");
        window.location.href = 'index.html';
      }
    }
  </script>

</body>

</html>